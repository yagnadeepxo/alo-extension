console.log("‚è∞ Universal LLM Time Tracker v2.0 loaded");(function(){const n={IDLE_TIMEOUT:6e4,STORAGE_PREFIX:"llm_tracker_"},a={isExtension:typeof chrome<"u"&&chrome.storage,async set(e,s){const t=n.STORAGE_PREFIX+e;if(this.isExtension)try{await chrome.storage.local.set({[t]:s}),console.log(`üíæ Saved to chrome storage: ${e} = ${s}`)}catch(i){console.warn("Chrome storage failed, using localStorage:",i),this.isExtension=!1,this.setLocal(t,s)}else this.setLocal(t,s)},async get(e,s=0){const t=n.STORAGE_PREFIX+e;if(this.isExtension)try{const o=(await chrome.storage.local.get([t]))[t]||s;return console.log(`üìñ Loaded from chrome storage: ${e} = ${o}`),o}catch(i){return console.warn("Chrome storage failed, using localStorage:",i),this.isExtension=!1,this.getLocal(t,s)}else return this.getLocal(t,s)},setLocal(e,s){try{localStorage.setItem(e,String(s)),console.log(`üíæ Saved to localStorage: ${e} = ${s}`)}catch(t){console.error("localStorage save failed:",t)}},getLocal(e,s){try{const t=localStorage.getItem(e),i=t!==null&&parseInt(t)||s;return console.log(`üìñ Loaded from localStorage: ${e} = ${i}`),i}catch(t){return console.error("localStorage read failed:",t),s}}};function c(){const e=window.location.hostname.toLowerCase();return e.includes("chatgpt.com")||e.includes("chat.openai.com")?"chatgpt":e.includes("claude.ai")?"claude":e.includes("deepseek.com")?"deepseek":e.includes("perplexity.ai")?"perplexity":e.includes("grok.com")||e.includes("x.ai")?"grok":e.includes("gemini.google.com")||e.includes("bard.google.com")?"gemini":e.includes("poe.com")?"poe":e.includes("character.ai")?"character":"unknown"}class h{constructor(){this.platform=c(),this.sessionStart=null,this.totalTime=0,this.isActive=!1,this.isVisible=!0,this.idleTimer=null,this.lastActivity=Date.now(),console.log(`üéØ Platform: ${this.platform}`),console.log(`üîß Storage: ${a.isExtension?"Chrome Extension":"localStorage"}`)}async init(){this.totalTime=await a.get(`${this.platform}_total_time`,0),console.log(`üìä Loaded total time: ${this.formatTime(this.totalTime)}`),this.startSession(),this.setupEventListeners(),console.log("‚úÖ Time tracker initialized")}startSession(){this.isActive||(this.sessionStart=Date.now(),this.isActive=!0,this.lastActivity=Date.now(),this.resetIdleTimer(),console.log(`üü¢ Session started for ${this.platform}`))}async endSessionAndSave(){if(this.isActive&&this.sessionStart){const s=Date.now()-this.sessionStart;this.totalTime+=s,await a.set(`${this.platform}_total_time`,this.totalTime),console.log(`üî¥ Session ended: +${this.formatTime(s)} (Total: ${this.formatTime(this.totalTime)})`),this.isActive=!1,this.sessionStart=null,this.clearIdleTimer()}}pauseSession(){this.isActive&&(console.log("‚è∏Ô∏è Session paused (idle timeout)"),this.isActive=!1,this.clearIdleTimer())}resetIdleTimer(){this.clearIdleTimer(),this.idleTimer=setTimeout(()=>{console.log(`üí§ User idle for ${n.IDLE_TIMEOUT/1e3}s, pausing timer`),this.pauseSession()},n.IDLE_TIMEOUT)}clearIdleTimer(){this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}handleActivity(){this.lastActivity=Date.now(),this.isVisible&&!this.isActive?this.startSession():this.isActive&&this.resetIdleTimer()}setupEventListeners(){["mousedown","mousemove","keydown","scroll","touchstart"].forEach(t=>{document.addEventListener(t,()=>this.handleActivity(),{passive:!0})}),document.addEventListener("visibilitychange",()=>{document.hidden?(console.log("üëÅÔ∏è Tab hidden - saving session"),this.isVisible=!1,this.endSessionAndSave()):(console.log("üëÅÔ∏è Tab visible"),this.isVisible=!0,this.lastActivity>Date.now()-n.IDLE_TIMEOUT&&this.startSession())}),window.addEventListener("blur",()=>{console.log("üò¥ Window blurred - saving session"),this.endSessionAndSave()}),window.addEventListener("focus",()=>{console.log("üéØ Window focused"),this.isVisible=!0,this.lastActivity>Date.now()-n.IDLE_TIMEOUT&&this.startSession()}),window.addEventListener("beforeunload",()=>{if(console.log("üíæ Page unloading - saving session"),this.isActive&&this.sessionStart){const t=Date.now()-this.sessionStart,i=this.totalTime+t;try{const o=n.STORAGE_PREFIX+`${this.platform}_total_time`;localStorage.setItem(o,String(i)),console.log(`üíæ Saved ${this.formatTime(t)} on unload (Total: ${this.formatTime(i)})`)}catch(o){console.error("Failed to save on unload:",o)}}})}getCurrentSessionTime(){return this.isActive&&this.sessionStart?Date.now()-this.sessionStart:0}getTotalTime(){return this.totalTime+this.getCurrentSessionTime()}formatTime(s){const t=Math.floor(s/1e3),i=Math.floor(t/60),o=Math.floor(i/60),l=Math.floor(o/24);return l>0?`${l}d ${o%24}h ${i%60}m`:o>0?`${o}h ${i%60}m`:i>0?`${i}m ${t%60}s`:`${t}s`}async reset(){this.pauseSession(),this.totalTime=0,await a.set(`${this.platform}_total_time`,0),console.log(`üîÑ ${this.platform} tracker reset`)}getStats(){return{platform:this.platform,isActive:this.isActive,isVisible:this.isVisible,sessionTime:this.getCurrentSessionTime(),totalTime:this.getTotalTime(),storageType:a.isExtension?"Chrome Extension":"localStorage",formatted:{session:this.formatTime(this.getCurrentSessionTime()),total:this.formatTime(this.getTotalTime())}}}}const r=new h;window.llmTimeTracker={getStats:()=>r.getStats(),reset:()=>r.reset(),forceStart:()=>r.startSession(),forceEnd:()=>r.endSessionAndSave(),export:()=>{const e=r.getStats();return console.log(`üìä ${r.platform} Time Tracker Export:`,e),e}},document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>r.init()):r.init(),console.log(`‚úÖ ${r.platform} Time Tracker v2.0 ready`)})();
